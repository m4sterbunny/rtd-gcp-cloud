
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Virtual Machines &#8212; Cloud Notes 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Virtual Private Cloud" href="virtual-networking.html" />
    <link rel="prev" title="Stackdriver" href="stackdriver.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="virtual-machines">
<h1>Virtual Machines<a class="headerlink" href="#virtual-machines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-and-linking-virtual-machines">
<h2>Creating and Linking Virtual Machines<a class="headerlink" href="#creating-and-linking-virtual-machines" title="Permalink to this headline">¶</a></h2>
<p>Virtual Machines (VMs) are a basic unit of cloud computing.</p>
<p>Setting one up from the console is a simple task:</p>
<div class="topic">
<p class="topic-title">Setup a VM from GCP</p>
<p>GCP &gt; Compute Engine &gt; VM Instances</p>
<blockquote>
<div><ul class="simple">
<li><p>Name your instance</p></li>
<li><p>Choose your zone (or accept default)</p></li>
<li><p>Decide you machine type (or accept default)</p></li>
<li><p>Decide your OS (Debian 9 Linux is a grand choice)</p></li>
<li><p>Modify the firewall to allow HTTP or HTTPS traffic</p></li>
</ul>
</div></blockquote>
</div>
<p>Launch GCP’s <a class="reference external" href="cloud-shell.html">Cloud Shell</a></p>
<p>This sets up a VM in the cloud, provisioned with an OS and the GCP SDK. This VM is configured to connect with the VM instances that <em>you</em> create.</p>
<div class="topic">
<p class="topic-title">Setup a VM from the command line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud compute instances create <span class="s2">&quot;my-new-vm&quot;</span>
</pre></div>
</div>
<p>You will be prompted for a Zone, because the high-level separation of services offered on the GCP are segregated by geographical zones.</p>
<p>&gt; 46 for us-central1-a</p>
<p>This minimal command creates a VM with default settings which, if you have not previously setup configurations, will be:</p>
<img alt="../_images/baseVM.PNG" class="align-center" src="../_images/baseVM.PNG" />
</div>
<p>Let’s be a little more decisive and prescribe some VM configurations this time. We will create 2 VMs from the command line and connect them.</p>
<div class="topic">
<p class="topic-title">Create &amp; Connect 2 VMs</p>
<p>First set your zone as a configuration setting:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud config <span class="nb">set</span> compute/zone us-central1-a
</pre></div>
</div>
<p>Then create the first VM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud compute instances create <span class="s2">&quot;vm1-zonea&quot;</span> <span class="se">\</span>
--machine-type <span class="s2">&quot;n1-standard-1&quot;</span> <span class="se">\</span>
--image-project <span class="s2">&quot;debian-cloud&quot;</span> <span class="se">\</span>
--image <span class="s2">&quot;debian-9-stretch-v20190213&quot;</span> <span class="se">\</span>
--subnet <span class="s2">&quot;default&quot;</span>
</pre></div>
</div>
<p>Then set your zone for the next VM:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud config <span class="nb">set</span> compute/zone us-central1-b
</pre></div>
</div>
<p>… and create the 2nd VM</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud compute instances create <span class="s2">&quot;vm2-zoneb&quot;</span> <span class="se">\</span>
--machine-type <span class="s2">&quot;n1-standard-1&quot;</span> <span class="se">\</span>
--image-project <span class="s2">&quot;debian-cloud&quot;</span> <span class="se">\</span>
--image <span class="s2">&quot;debian-9-stretch-v20190213&quot;</span> <span class="se">\</span>
--subnet <span class="s2">&quot;default&quot;</span>
</pre></div>
</div>
<p>Let’s see if our 2 VMs can connect.</p>
<p>SSH into vm2-zoneb</p>
<p>GCP&gt; Compute Engine&gt; VM instances&gt; SSH</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ping my-vm-1 -c <span class="m">3</span>
</pre></div>
</div>
<p>NB if you don’t set the count for the number of pings then use Ctrl+C to abort the ping command.</p>
</div>
</div>
<div class="section" id="zones-matter">
<h2>Zones matter<a class="headerlink" href="#zones-matter" title="Permalink to this headline">¶</a></h2>
<p>VM instances are assigned to a zone, that is a sub-region. Zones within a region are better connected that zones between regaions. You have to specify your zone when you set up your VM.</p>
<p>Zone selection may be vital if the following affect you:</p>
<blockquote>
<div><ul class="simple">
<li><p>Cost, not all regions are equal!</p></li>
<li><p>Data legislation may mean that personal and sensitive data should not be transferred to other countries (see <a class="reference external" href="UK_Data_link_https://www.ukdataservice.ac.uk/manage-data/store/security">UK Data protection issues</a>)</p></li>
<li><dl class="simple">
<dt>Performance, if you users are multi-regional then your service may be improved by running multiple instances in different regions.</dt><dd><dl class="simple">
<dt>NB performance may be impacted by:</dt><dd><ul>
<li><p>Availability</p></li>
<li><p>Latency</p></li>
</ul>
</dd>
</dl>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="creating-your-own-image">
<h2>Creating your own image<a class="headerlink" href="#creating-your-own-image" title="Permalink to this headline">¶</a></h2>
<p>Once you have chosen an image that is close to what you need, either from the GCP itself, its marketplace, by uploading your own custom image, or sourcing from a 3rd party, you may make additional changes to it.</p>
<p>This may include updating or adding libraries or software.</p>
<p>If your project is not simply a one off, then you may use this as a base-image for future projects by creating a snapshot, i.e. by grabbing an image from the boot disk of your VM.</p>
</div>
<div class="section" id="importing-a-custom-image">
<h2>Importing a custom image<a class="headerlink" href="#importing-a-custom-image" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="preemptilble-vms">
<h2>Preemptilble VMs<a class="headerlink" href="#preemptilble-vms" title="Permalink to this headline">¶</a></h2>
<p>Where you need a short-lived VM to crunch a specific workload, for example, cyclic reporting you may set up a VM that will persist for up to 24 hours. A preemptible VM may be interupted with only 30s warning, which is why they are cheaper and not suitable for service-delivery.</p>
<p>You can even split workloads across “permanent VMs” and premtiple VMs.</p>
</div>
<div class="section" id="keen-to-make-something-useful">
<h2>Keen to make something useful?<a class="headerlink" href="#keen-to-make-something-useful" title="Permalink to this headline">¶</a></h2>
<p>It is tough to learn system setup in isolation of normal day to day requirements.</p>
<p>Let’s go through a real-world example to bust through the rather abstract ones - e.g., setting up a VM to act as a server for a web page.</p>
<p>Activate Cloud Shell and use the GCP SDK that it provides.</p>
<p>First, set your zone as a configuration setting:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud config <span class="nb">set</span> compute/zone us-central1-a
</pre></div>
</div>
</div></blockquote>
<p>Setup a new VM:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud compute instances create <span class="s2">&quot;my-web-server&quot;</span>
--machine-type <span class="s2">&quot;n1-standard-1&quot;</span> <span class="se">\</span>
--image-project <span class="s2">&quot;debian-cloud&quot;</span> <span class="se">\</span>
--image <span class="s2">&quot;debian-9-stretch-v20190213&quot;</span> <span class="se">\</span>
--subnet <span class="s2">&quot;default&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Allow HTTP traffic with</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud compute firewall-rules create my-web-server --allow tcp:80
</pre></div>
</div>
</div></blockquote>
<p>From the GCP console connect to your VM with SSH to set up Apache2 HTTP Server:</p>
<p>GCP&gt; Compute Engine&gt; VM Instances&gt; my-web-server &gt; SSH</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install apache2 php7.0
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo service apache2 restart
</pre></div>
</div>
</div></blockquote>
<p>Return to your GCP console and click on the External IP for your VM. This should take you through to your apache landing page.</p>
<p>OR use curl from the SSH connection to your VM’s command line:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl http://<span class="o">[</span>Your-External-IP<span class="o">]</span>
</pre></div>
</div>
<p>Either option should return the apache landing page.</p>
</div>
<div class="section" id="gcp-cloud-shell">
<h2>GCP Cloud Shell<a class="headerlink" href="#gcp-cloud-shell" title="Permalink to this headline">¶</a></h2>
<p>Google’s Cloud Shell is a Linux VM that is pre-loaded with development tools including GCP’s SDK. It provides a persistent 5GB home directory and runs on the GCP. Google’s Cloud Shell provides command-line access to your GCP resources.</p>
<p>One of the great features of the Cloud Shell environment is that you may store environment variables. This enables you to work with features such as multiple projects without having to return to the console.</p>
<p>..topic:: Storing project id as an environment variable</p>
<blockquote>
<div><p>If you have multiple projects storing their id with a simple name can speed up work immensely.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud config list <span class="p">|</span> grep project
</pre></div>
</div>
</div></blockquote>
<p>Will provide your project id, which may look something like this:</p>
<blockquote>
<div><p>loony-tunes-251324</p>
</div></blockquote>
<p>Rather than have to pull the project id every time you want to use it you can shortcode this using:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>export Proj-1=loony-tunes-251324</p>
</div></blockquote>
</div></blockquote>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Cloud Notes</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">Enabling APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts-billing.html">Accounts &amp; Billing</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud-shell.html">Cloud Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="kubernetes.html">Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="stackdriver.html">Stackdriver</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Virtual Machines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-and-linking-virtual-machines">Creating and Linking Virtual Machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#zones-matter">Zones matter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-own-image">Creating your own image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#importing-a-custom-image">Importing a custom image</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preemptilble-vms">Preemptilble VMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#keen-to-make-something-useful">Keen to make something useful?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gcp-cloud-shell">GCP Cloud Shell</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="virtual-networking.html">Virtual Private Cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts-billing-quiz.html">Review Questions Billing &amp; Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="accounts-billing-quiz.html#answers-billing-accounts">Answers Billing &amp; Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="database-options.html">GCP Database Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="ace-exam.html">ACE</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="stackdriver.html" title="previous chapter">Stackdriver</a></li>
      <li>Next: <a href="virtual-networking.html" title="next chapter">Virtual Private Cloud</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, masterbunny.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/pages/VMs.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>